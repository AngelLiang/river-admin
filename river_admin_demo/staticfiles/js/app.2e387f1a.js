(function(t){function e(e){for(var a,s,r=e[0],l=e[1],c=e[2],u=0,_=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&_.push(o[s][0]),o[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(_.length)_.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],a=!0,r=1;r<i.length;r++){var l=i[r];0!==o[l]&&(a=!1)}a&&(n.splice(e--,1),t=s(s.s=i[0]))}return t}var a={},o={app:0},n=[];function s(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=a,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;n.push(["037d","chunk-vendors"]),i()})({"037d":function(t,e,i){"use strict";i.r(e);var a=i("2b0e"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(t.layout,{tag:"component",attrs:{id:"app"}},[i("v-row",{attrs:{align:"center"}},[i("v-col",[i("router-view")],1)],1),i("v-snackbar",{staticClass:"mt-10",attrs:{color:t.snackbar_color,top:!0,timeout:t.snackbar_timeout},model:{value:t.show_snackbar,callback:function(e){t.show_snackbar=e},expression:"show_snackbar"}},[i("v-icon",{attrs:{color:"white",left:""}},[t._v(t._s(t.snackbar_icon))]),i("v-container",t._l(t.snackbar_texts,(function(e,a){return i("v-row",{key:a},[i("v-col",[t._v(t._s(e))])],1)})),1),i("v-btn",{attrs:{dark:"",text:""},on:{click:function(e){t.show_snackbar=!1}}},[t._v("Close")])],1)],1)},n=[],s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",{attrs:{id:"inspire"}},[t._t("default")],2)},r=[],l={name:"NotLoggedInLayout",data:()=>({})},c=l,d=i("2877"),u=Object(d["a"])(c,s,r,!1,null,null,null),_=u.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.initialized?a("v-app",{attrs:{id:"inspire"}},[a("v-app-bar",{attrs:{app:"","clipped-right":"",color:"blue",dark:""},on:{click:function(e){e.stopPropagation(),t.mini=!0}}},[a("v-toolbar-title",{style:{cursor:"pointer"},on:{click:t.goToHomePage}},[a("v-row",{attrs:{justify:"center",align:"center"}},[a("v-col",[a("img",{staticClass:"mt-2 toolbar-logo",attrs:{src:i("f3e5")}})]),a("v-col",[a("span",{staticClass:"app-title"},[t._v("River Admin")])])],1)],1),a("div",{staticClass:"flex-grow-1"}),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-icon",t._g({staticClass:"mr-2"},i),[t._v("mdi-account")])]}}],null,!1,2921913006)},[a("span",[t._v(t._s(t.user_profile.username))])]),a("v-btn",{attrs:{icon:""},on:{click:t.logout}},[a("v-icon",[t._v("mdi-logout")])],1)],1),a("v-content",[a("v-container",{staticClass:"pa-0",attrs:{align:"start",justify:"start",fluid:""}},[a("v-row",{attrs:{"no-gutters":"",align:"start",justify:"start"}},[a("v-col",{attrs:{xl:"auto",lg:"auto",md:"auto",sm:"auto",xs:"auto"}},[a("div",{class:t.mini?"mini-drawer-shadow":"drawer-shadow"}),a("v-navigation-drawer",{staticClass:"drawer",attrs:{"mini-variant":t.mini,permanent:"",fixed:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-list-item",{attrs:{jusitfy:"center",align:"center"}},[a("v-list-item-title",[t._v("Menu")])],1),a("v-divider"),a("v-list",{attrs:{dense:""}},t._l(t.items,(function(e){return a("v-list-item",{key:e.title,attrs:{disabled:e.disabled,id:e.id,link:""},on:{click:function(i){return t.goTo(e)}}},[a("v-list-item-icon",[a("v-icon",{attrs:{disabled:e.disabled}},[t._v(t._s(e.icon))])],1),a("v-list-item-content",[a("v-list-item-title",[t._v(t._s(e.title))])],1)],1)})),1),a("v-divider"),a("v-list",{attrs:{dense:""}},t._l(t.workflow_items,(function(e){return a("v-list-item",{key:e.title,attrs:{id:e.id,link:""},on:{click:function(i){return t.goTo(e)}}},[a("v-list-item-icon",[a("v-icon",[t._v(t._s(e.icon))])],1),a("v-list-item-content",[a("v-list-item-title",[t._v(t._s(e.title))])],1)],1)})),1),a("v-divider"),a("v-divider"),a("v-row",[a("div",{staticClass:"flex-grow-1"}),a("v-col",[a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.mini=!t.mini}}},[t.mini?a("v-icon",[t._v("mdi-chevron-double-right")]):a("v-icon",[t._v("mdi-chevron-double-left")])],1)],1),a("div",{staticClass:"flex-grow-1"})],1)],1)],1),a("v-col",[t._t("default")],2)],1)],1)],1)],1):t._e()},h=[];const v=new a["default"],f="SUCESS",m="ERROR",g="LOGOUT";function k(t,e){v.$emit(f,t,e)}function w(t,e){v.$emit(m,t,e)}function b(){v.$emit(g)}function y(t){v.$on(f,t)}function x(t){v.$on(m,t)}function C(t){v.$on(g,t)}var j=i("2f62");a["default"].use(j["a"]);const $=new j["a"].Store({state:{user:{}},mutations:{initialiseStore(t){localStorage.getItem("store")&&this.replaceState(Object.assign(t,JSON.parse(localStorage.getItem("store"))))},setAuthToken(t,e){t.user.token=e},unSetAuthToken(t){t.user.token=null}}});$.subscribe((t,e)=>{localStorage.setItem("store",JSON.stringify(e))});var S=$,D=i("bc3a"),E=i.n(D);const T=1e4,H=()=>({Authorization:`Token ${S.state.user.token}`});class A{_request(t,e){return E()(t).then(e).catch(t=>{t.response?401==t.response.status||403==t.response.status?b():this.handle_error(t.response):console.error(t)})}get(t,e){return this._request({method:"get",url:t,headers:H()},e)}post(t,e,i){return this._request({method:"post",url:t,data:e,headers:H()},i)}put(t,e,i){return this._request({method:"put",url:t,data:e,headers:H()},i)}delete(t,e){return this._request({method:"delete",url:t,headers:H()},e)}handle_error(t){400==t.status&&t.data.forEach(t=>{switch(t.error_code){case T:w(this.build_protection_error_messages(t));break;default:console.log(`An unexpected error occured with the code ${t.error_code}`)}})}build_protection_error_messages(t){return new Set(t.detail.protected_errors.map(t=>{var e="";switch(t.object_type){case"workflow":e="workflow";break;case"state":e="state";break;case"transitionmeta":e="transition meta";break;case"transitionapprovalmeta":e="transition approval meta";break;case"transition":e="transition";break;case"transitionapproval":e="transition approval";break;case"ontransitionhook":e="transition hook";break;case"onapprovedhook":e="approval hook";break;default:return console.error(`Unexpected protected object type ${t.object_type}`),null}return`Can not delete since there is a dependant ${e} object`}))}}var O=new A,P=O;const W="add",z="change",q="delete",L="view",F="workflow",N="state",I="function";class R{_has_permission(t,e,i){return P.get(`/user/has_river_permission/${t}/${e}`,t=>{t.data?i(!0):i(!1)})}has_add_permission(t,e){return this._has_permission(W,t,e)}has_change_permission(t,e){return this._has_permission(z,t,e)}has_delete_permission(t,e){return this._has_permission(q,t,e)}has_view_permission(t,e){return this._has_permission(L,t,e)}}var M=new R,U={name:"LoggedInLayout",data:()=>({initialized:!1,drawer:!1,mini:!0,items:[],workflow_items:[],user_profile:null,raw_items:[{id:"workflow-list",title:"Workflows",icon:"mdi-file-tree",name:"list-workflows",authorization_object_type:F},{id:"state-list",title:"States",icon:"mdi-label-variant-outline",name:"list-states",authorization_object_type:N},{id:"function-list",title:"Functions",icon:"mdi-function-variant",name:"list-callback-functions",authorization_object_type:I}]}),mounted(){if(!this.initialized){var t=P.get("/user/get/",t=>{this.user_profile=t.data}),e=M.has_view_permission(F,t=>{if(t)return P.get("/workflow/metadata",t=>{this.workflow_items=t.data.map(t=>({id:t.id,title:t.name,icon:t.icon,name:"list-workflow-objects",params:{workflow_id:t.id}}))})});Promise.all(this.raw_items.map((t,e)=>{if(t.authorization_object_type)return M.has_view_permission(t.authorization_object_type,i=>{this.items.push({id:t.id,title:t.title,icon:t.icon,name:t.name,index:e,disabled:!i})})}).concat([t,e])).then(()=>{this.items=this.items.sort((t,e)=>t.index-e.index),this.initialized=!0})}},methods:{logout(){b()},goToHomePage(){this.$router.push({name:"home"})},goTo(t){this.$router.push({name:t.name,params:t.params||{}})}}},G=U,J=(i("5a6f"),Object(d["a"])(G,p,h,!1,null,null,null)),V=J.exports;const B="LoggedInLayout";var Q={name:"app",components:{LoggedInLayout:V,NotLoggedInLayout:_},computed:{layout(){return this.$route.meta.layout||B}},mounted(){var t=this;C(()=>{this.$store.commit("unSetAuthToken"),this.$router.push({name:"login"})}),x((e,i)=>{this.snackbar_timeout=i||this.default_snackbar_timeout,t.error(e)}),y((e,i)=>{this.snackbar_timeout=i||this.default_snackbar_timeout,t.success([e])})},data:()=>({show_snackbar:!1,snackbar_icon:null,snackbar_timeout:null,snackbar_color:"grey",snackbar_texts:null,default_snackbar_timeout:4e3}),methods:{success(t){this.snackbar_icon="mdi-check-all",this.snackbar_texts=t,this.snackbar_color="success",this.show_snackbar=!0},error(t){this.snackbar_icon="mdi-shield-half-full",this.snackbar_texts=t,this.snackbar_color="error",this.show_snackbar=!0}}},Y=Q,K=(i("e4a5"),Object(d["a"])(Y,o,n,!1,null,null,null)),X=K.exports,Z=i("ce5b"),tt=i.n(Z);i("bf40"),i("5363");a["default"].use(tt.a,{iconfont:"mdi"});const et={};var it=new tt.a(et),at=i("8c4f"),ot=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-content",[i("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[i("v-row",{attrs:{align:"center",justify:"center"}},[i("v-col",{attrs:{cols:"12",sm:"8",md:"4"}},[i("v-card",{staticClass:"elevation-12",attrs:{"pa-5":""}},[i("v-toolbar",{attrs:{color:"primary",dark:"",flat:""}},[i("v-toolbar-title",[t._v("River Admin")]),i("div",{staticClass:"flex-grow-1"})],1),i("v-card-text",[i("v-form",[i("v-text-field",{attrs:{label:"Login",name:"login","prepend-icon":"mdi-account",type:"text"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),i("v-text-field",{attrs:{id:"password",label:"Password",name:"password","prepend-icon":"mdi-lock",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1)],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"primary"},on:{click:t.login}},[t._v("Login")])],1)],1)],1)],1)],1)],1)},nt=[],st={props:{source:String},data:()=>({username:null,password:null}),methods:{login(){this.error_message=null,this.alert=!1,E.a.post("/api-token-auth/",{username:this.username,password:this.password}).then(t=>{this.$store.commit("setAuthToken",t.data.token),M.has_view_permission(F,t=>{t?this.$route.params.nextUrl?this.$router.push({path:this.$route.params.nextUrl}):this.$router.push({name:"home"}):(this.$store.commit("unSetAuthToken"),w(["You has to have the permission to view the workflows!"],1e4))})}).catch(t=>{w(["Authentication failed with given credentials!"],1e4)})}}},rt=st,lt=Object(d["a"])(rt,ot,nt,!1,null,null,null),ct=lt.exports,dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.initialized?i("v-container",{attrs:{fluid:""}},[0==t.items.length?i("v-container",{attrs:{fluid:""}},[i("EmptyState",{attrs:{label:"You don't seem to have any workflow",description:"Why don't you create your first workflow?"},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v("mdi-sitemap")]},proxy:!0},{key:"content",fn:function(){return[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-btn",{attrs:{block:"",color:"primary"},on:{click:t.goToCreateWorkflowPage}},[t._v("Begin")])],1)],1)]},proxy:!0}],null,!1,2521590817)})],1):i("v-container",{attrs:{fluid:""}},[i("v-flex",[t.message?i("v-alert",{staticClass:"transition-swing",attrs:{type:"success",transition:"scale-transition"},model:{value:t.messageAlert,callback:function(e){t.messageAlert=e},expression:"messageAlert"}},[t._v(t._s(t.message))]):t._e()],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-sitemap")]),t._v(" Workflows\n        ")],1)])],1),i("v-row",t._l(t.items,(function(e){return i("v-col",{key:e.id,attrs:{xl:"2",lg:"3",md:"4",sm:"12",xs:"12"}},[i("v-hover",{scopedSlots:t._u([{key:"default",fn:function(a){var o=a.hover;return[i("v-card",{attrs:{elevation:o?24:6,height:"300","min-width":"200"}},[i("v-card-text",{staticClass:"card-text"},[i("v-row",{staticClass:"fill-height"},[e.admin_name?i("v-col",[e.admin_icon?i("v-row",{staticClass:"mt-5 mb-10",attrs:{align:"center",justify:"center"}},[i("v-icon",{attrs:{color:"primary","x-large":""}},[t._v(t._s(e.admin_icon))])],1):t._e(),i("v-row",{staticClass:"mt-5 mb-10",attrs:{align:"center",justify:"center"}},[i("H5Max",{attrs:{max:"16"},model:{value:e.admin_name,callback:function(i){t.$set(e,"admin_name",i)},expression:"item.admin_name"}})],1)],1):i("v-col",[i("v-row",{staticClass:"mt-5 mb-10",attrs:{align:"center",justify:"center"}},[i("H5Max",{attrs:{max:"16"},model:{value:e.content_type.app_label,callback:function(i){t.$set(e.content_type,"app_label",i)},expression:"item.content_type.app_label"}})],1),i("v-row",{staticClass:"mb-10",attrs:{align:"center",justify:"center"}},[i("H5Max",{attrs:{max:"16"},model:{value:e.content_type.model,callback:function(i){t.$set(e.content_type,"model",i)},expression:"item.content_type.model"}})],1),i("v-row",{attrs:{align:"center",justify:"center"}},[i("H5Max",{attrs:{max:"16"},model:{value:e.field_name,callback:function(i){t.$set(e,"field_name",i)},expression:"item.field_name"}})],1)],1)],1)],1),i("v-divider"),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var o=a.on;return[i("v-btn",t._g({attrs:{icon:"",color:"primary"},on:{click:function(i){return t.goToViewWorkflowPage(e.id)}}},o),[i("v-icon",[t._v("mdi-details")])],1)]}}],null,!0)},[i("span",[t._v("View Workflow")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var o=a.on;return[i("v-btn",t._g({attrs:{icon:"",color:"primary",disabled:!t.has_change_workflow_permission},on:{click:function(i){return t.goToEditWorkflowPage(e.id)}}},o),[i("v-icon",[t._v("mdi-pencil")])],1)]}}],null,!0)},[i("span",[t._v("Edit Workflow")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var o=a.on;return[i("v-btn",t._g({attrs:{icon:"",color:"primary",disabled:!t.has_change_workflow_permission},on:{click:function(i){return t.goToEditWorkflowRulePage(e.id)}}},o),[i("v-icon",[t._v("mdi-axis-arrow-lock")])],1)]}}],null,!0)},[i("span",[t._v("Edit Workflow Rules")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var o=a.on;return[i("v-btn",t._g({attrs:{icon:"",color:"warning",disabled:!t.has_delete_workflow_permission},on:{click:function(i){return t.showDeletingDialog(e)}}},o),[i("v-icon",[t._v("mdi-delete")])],1)]}}],null,!0)},[i("span",[t._v("Delete Workflow")])]),i("div",{staticClass:"flex-grow-1"})],1)],1)]}}],null,!0)})],1)})),1),t.has_add_workflow_permission?i("div",{staticClass:"fab_container"},[i("v-btn",{attrs:{large:"",color:"primary",dark:"",fab:""},on:{click:t.goToCreateWorkflowPage}},[i("v-icon",[t._v("mdi-plus")])],1)],1):t._e(),this.deletingWorkflow?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("\n          Delete workflow  \n          "),i("v-chip",{attrs:{color:"primary"}},[t._v(t._s(t.deletingWorkflow.identifier))]),t._v("  ?\n        ")],1),i("v-card-text",[t._v("Deleting the workflow will delete all transitions and approval meta data belongs to it.")]),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.deleteWorkflow()}}},[t._v("Agree")])],1)],1)],1):t._e()],1)],1):t._e()},ut=[],_t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-icon",{staticStyle:{"font-size":"150px"}},[t._t("icon")],2)],1),t.label?i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("p",{staticClass:"subtitle-1"},[t._v(t._s(t.label))])])],1):t._e(),t.description?i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("p",{staticClass:"subtitle-3"},[t._v(t._s(t.description))])])],1):t._e(),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[t._t("content")],2)],1)],1)],1)],1)},pt=[],ht={name:"EmptyState",props:["label","description"]},vt=ht,ft=Object(d["a"])(vt,_t,pt,!1,null,null,null),mt=ft.exports,gt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.value.length<=t.max?i("h5",[t._v(t._s(t.value))]):i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("h5",t._g({},a),[t._v(t._s(t.value.substring(0,t.max)+"..."))])]}}])},[i("span",[t._v(t._s(t.value))])])},kt=[],wt={name:"H5Max",props:["value","max"]},bt=wt,yt=Object(d["a"])(bt,gt,kt,!1,null,null,null),xt=yt.exports;class Ct{constructor(t,e,i,a){this.id=t,this.content_type=e,this.initial_state=i,this.field_name=a,this.identifier=`${this.content_type.app_label}.${this.content_type.model}.${this.field_name}`}static of(t,e,i,a){return new Ct(t,e,i,a)}static create(t,e,i){var a="_"+Math.random().toString(36).substr(2,9);return new Ct(a,t,e,i)}to_create_request(){return{content_type:this.content_type.id,field_name:this.field_name,initial_state:this.initial_state.id}}}class jt{constructor(t,e,i){this.id=t,this.name=e,this.body=i}static of(t,e,i){return new jt(t,e,i)}}class $t{constructor(t,e,i){this.id=t,this.label=e,this.is_new=i}static of(t,e){return new $t(t,e,!1)}static create(t){var e="_"+Math.random().toString(36).substr(2,9);return new $t(e,t,!0)}to_create_request(){return{label:this.label}}}class St{constructor(t,e,i,a,o){this.id=t,this.workflow=e,this.source_state_id=i,this.destination_state_id=a,this.hooks=[],this.is_new=o}static of(t,e,i,a){return new St(t,e,i,a,!1)}static create(t,e,i){var a=e+"+"+i;return new St(a,t,e,i,!0)}to_create_request(){return{workflow:this.workflow.id,source_state:this.source_state_id,destination_state:this.destination_state_id}}}class Dt{constructor(t,e,i,a,o,n){this.id=t,this.workflow=e,this.transition_id=i,this.permissions=a,this.groups=o||[],this.priority=n||[],this.hooks=[]}static of(t,e,i,a,o,n){return new Dt(t,e,i,a,o,n)}static create(t,e,i,a,o){var n="_"+Math.random().toString(36).substr(2,9);return new Dt(n,e,t,i,a,o)}to_create_request(){return{workflow:this.workflow.id,transition_meta:this.transition_id,source_state:this.source_state_id,destination_state:this.destination_state_id,permissions:this.permissions.map(t=>t.id),groups:this.groups.map(t=>t.id),priority:this.priority}}}class Et{constructor(t,e,i,a,o,n,s){this.id=t,this.workflow=e,this.callback_function=i,this.workflow_object_id=n,this.transition_meta=a,this.transition=o,this.is_executed=s}static of(t,e,i,a,o,n,s){return new Et(t,e,i,a,o,n,s)}static create(t,e,i,a,o){var n="_"+Math.random().toString(36).substr(2,9);return new Et(n,t,e,i,a,o,!1)}is_from_upstream(){return null==this.workflow_object_id}to_create_request(){return{workflow:this.workflow.id,callback_function:this.callback_function.id,transition_meta:this.transition_meta||null,transition:this.transition||null,object_id:parseInt(this.workflow_object_id)||null,content_type:this.workflow_object_id?this.workflow.content_type.id:null}}}class Tt{constructor(t,e,i,a,o,n,s){this.id=t,this.workflow=e,this.transition_approval_meta_id=a,this.callback_function=i,this.workflow_object_id=n,this.transition_approval_id=o,this.is_executed=s}static of(t,e,i,a,o,n,s){return new Tt(t,e,i,a,o,n,s)}static create(t,e,i,a,o){var n="_"+Math.random().toString(36).substr(2,9);return new Tt(n,t,e,i,a,o,!1)}is_from_upstream(){return null==this.workflow_object_id}to_create_request(){return{workflow:this.workflow.id,callback_function:this.callback_function.id,transition_approval_meta:this.transition_approval_meta_id,transition_approval:this.transition_approval_id||null,object_id:parseInt(this.workflow_object_id)||null,content_type:this.workflow_object_id?this.workflow.content_type.id:null}}}class Ht{constructor(t,e,i,a,o,n,s,r,l){this.id=t,this.workflow=e,this.transition_meta=o,this.source_state_id=i,this.destination_state_id=a,this.object_id=n,this.iteration=s,this.approvals=[],this.hooks=[],this.is_cancelled=r,this.is_done=l}static of(t,e,i,a,o,n,s,r,l){return new Ht(t,e,i,a,o,n,s,r,l)}}class At{constructor(t,e,i,a,o,n,s,r,l,c){this.id=t,this.workflow=e,this.transition_meta=i,this.transition_approval_meta=a,this.object_id=o,this.permissions=n,this.groups=s,this.priority=r,this.hooks=[],this.status=l,this.transactioner=c,this.is_approved="approved"==this.status}static of(t,e,i,a,o,n,s,r,l,c){return new At(t,e,i,a,o,n,s,r,l,c)}}var Ot={name:"ListWorkflowPage",components:{EmptyState:mt,H5Max:xt},computed:{deletingWorkflowDialogTitle(){return`Delete workflow ${this.deletingWorkflow.identifier}?`}},mounted(){this.fetchWorkflows(),this.message=this.$route.query.message,this.$route.query.message&&this.setAlertMessage(this.$route.query.message)},data:()=>({initialized:!1,messageAlert:!0,message:null,deletingWorkflow:null,deleteDialog:!1,has_add_workflow_permission:!1,has_delete_workflow_permission:!1,has_change_workflow_permission:!1,items:[]}),methods:{setAlertMessage(t){this.message=t,this.messageAlert=!0;var e=this;setTimeout(()=>e.messageAlert=!1,3e3)},fetchWorkflows(){var t=P.get("/workflow/list/",t=>{this.items=t.data.map(t=>{var e=Ct.of(t.id,t.content_type,t.initial_state,t.field_name);return e.admin_name=t.admin_name,e.admin_icon=t.admin_icon,e})}),e=M.has_add_permission(F,t=>{this.has_add_workflow_permission=t}),i=M.has_change_permission(F,t=>{this.has_change_workflow_permission=t}),a=M.has_delete_permission(F,t=>{this.has_delete_workflow_permission=t});Promise.all([t,e,i,a]).then(()=>this.initialized=!0)},goToCreateWorkflowPage(){this.$router.push({name:"create-workflow"})},goToViewWorkflowPage(t){this.$router.push({name:"view-workflow",params:{id:t}})},goToEditWorkflowPage(t){this.$router.push({name:"edit-workflow",params:{id:t}})},goToEditWorkflowRulePage(t){this.$router.push({name:"edit-workflow-rules",params:{id:t}})},showDeletingDialog(t){this.deletingWorkflow=t,this.deleteDialog=!0},deleteWorkflow(){this.deletingWorkflow&&P.delete(`/workflow/delete/${this.deletingWorkflow.id}/`,()=>{this.fetchWorkflows(),this.deleteDialog=!1,k(`Workflow ${this.deletingWorkflow.identifier} is deleted.`)})}}},Pt=Ot,Wt=(i("daf8"),Object(d["a"])(Pt,dt,ut,!1,null,null,null)),zt=Wt.exports,qt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("EmptyState",{attrs:{label:"Create your initial state",description:"Creating your initial state, you'll be able to start designing your workflow."},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v("mdi-file-tree")]},proxy:!0},{key:"content",fn:function(){return[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("WorkflowInput",{model:{value:t.workflow,callback:function(e){t.workflow=e},expression:"workflow"}})],1)],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("StateInput",{attrs:{placeholder:"Search for initial state"},model:{value:t.initial_state,callback:function(e){t.initial_state=e},expression:"initial_state"}})],1)],1),i("v-row",[i("v-btn",{attrs:{block:"",color:"primary",disabled:!(t.workflow&&t.initial_state)},on:{click:t.createWorkflow}},[t._v("Create")])],1)]},proxy:!0}])})],1)},Lt=[],Ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-autocomplete",{attrs:{items:t.items,loading:t.loading,"search-input":t.search,"hide-selected":"","item-text":"identifier",label:"Search for a workflow...",clearable:"","return-object":""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n        Start typing to search for the\n        "),i("strong",[t._v("workflows")])])],1)]},proxy:!0},{key:"selection",fn:function(e){e.attr,e.on;var i=e.item;e.selected;return[t._v(t._s(i.identifier))]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.identifier)}})],1)]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})},Nt=[],It={name:"WorkflowInput",props:["value"],data:()=>({loading:!1,items:[],search:null,model:null}),watch:{model(t){this.$emit("input",t)},search(t){this.items.length>0||(this.loading=!0,P.get("/workflow/state-field/list/",t=>{this.items=t.data.map(t=>Ct.create(t.content_type,null,t.field_name))}).finally(()=>this.loading=!1))}}},Rt=It,Mt=Object(d["a"])(Rt,Ft,Nt,!1,null,null,null),Ut=Mt.exports,Gt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.initialized?i("v-autocomplete",{attrs:{items:t.items,loading:t.loading,"search-input":t.search,"hide-selected":"","item-text":"final_label",label:t.placeholder,disabled:t.disabled,clearable:"","return-object":""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n        Start typing to search for the\n        "),i("strong",[t._v("state")])])],1)]},proxy:!0},{key:"selection",fn:function(e){e.attr,e.on;var i=e.item;e.selected;return[t._v(t._s(i.label))]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.final_label)}})],1)]}}],null,!1,2912951547),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}):t._e()},Jt=[],Vt={name:"StateInput",props:["value","placeholder","disabled"],data:()=>({initialized:!1,loading:!1,items:[],search:null,model:null,has_add_state_permission:!1}),mounted(){M.has_add_permission(N,t=>{this.has_add_state_permission=t}).finally(()=>this.initialized=!0)},watch:{model(t){this.$emit("input",t)},value(t){null==t&&(this.model=null)},search(t){!t||this.model&&t===this.model.final_label||(this.loading=!0,this._getRemoteStates().then(e=>{var i=null;this.has_add_state_permission&&t&&!e.find(e=>e.label==t)&&(i=$t.create(t));var a=i?[i].concat(e):e,o=Object.values(a.reduce((t,e)=>{return t[e.label]=e,t},{})).sort((t,e)=>t.is_new||t.id<e.id?-1:1);this.items=o.filter(e=>e.label.includes(t)).map(t=>{return t.final_label=t.is_new?t.label+" (Create)":t.label,t})}).finally(()=>this.loading=!1))}},methods:{_getRemoteStates(){return P.get("/state/list/",t=>{return t.data.map(t=>$t.of(t.id,t.label))})}}},Bt=Vt,Qt=Object(d["a"])(Bt,Gt,Jt,!1,null,null,null),Yt=Qt.exports,Kt={name:"CreateWorkflowPage",components:{WorkflowInput:Ut,StateInput:Yt,EmptyState:mt},data:()=>({workflow:null,initial_state:null}),methods:{createWorkflow(){if(this.workflow&&this.initial_state){var t=Promise.resolve();this.initial_state.is_new&&(t=P.post("/state/create/",this.initial_state.to_create_request(),t=>{this.initial_state.is_new=!1,this.initial_state.id=t.data.id,this.initial_state.final_label=this.initial_state.label})),t.then(t=>{this.workflow.initial_state=this.initial_state,P.post("/workflow/create/",this.workflow.to_create_request(),t=>{this.workflow.id=t.data.id,k(`Workflow ${this.workflow.identifier} is created with initial state ${this.initial_state.label}`),this.$router.push({name:"edit-workflow",params:{id:this.workflow.id}})})})}}}},Xt=Kt,Zt=Object(d["a"])(Xt,qt,Lt,!1,null,null,null),te=Zt.exports,ee=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.initialized?i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col"),i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[t._v("\n          Workflow for\n          "),i("v-chip",[t._v(t._s(t.workflow.identifier))])],1)]),i("v-col",{attrs:{justify:"center",align:"end"}},[i("v-btn",{staticClass:"mr-5",attrs:{disabled:0==t.transitions.length,color:"primary"},on:{click:t.goToEditWorkflowRules}},[t._v("Edit Workflow Rules")])],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("WorkflowIllustration",{attrs:{states:t.states,transitions:t.transitions,state_class_mapping:t.state_class_mapping,editable:!0},on:{"on-transition-selected":t.onTransitionSelected,"on-state-clicked":t.onStateSelected}})],1)],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{cols:"6"}},[i("StateInput",{attrs:{disabled:!t.selected_state,placeholder:t.selected_state?"New state from '"+t.selected_state.label+"':":"Select a state to creat a transition"},model:{value:t.new_transition_state,callback:function(e){t.new_transition_state=e},expression:"new_transition_state"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-btn",{attrs:{disabled:!t.selected_state||!t.new_transition_state,large:"",color:"primary"},on:{click:t.createState}},[t._v("Create")])],1)],1)],1):t._e()],1)},ie=[],ae=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{directives:[{name:"resize",rawName:"v-resize",value:t.onResize,expression:"onResize"}],staticClass:"mx-auto pa-5",attrs:{elevation:6}},[i("v-card-text",[i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{id:"svg-container",justify:"center",align:"center"}},[i("svg",{staticClass:"shadow",attrs:{width:"650",height:"270"}})])],1)],1)],1)],1)},oe=[],ne=i("5698"),se=i("1226"),re=i.n(se),le={name:"WorkflowIllustration",props:["states","transitions","editable","state_class_mapping"],computed:{},data:()=>({svg:null,initialized:!1,selected_transition_id:null,windowSize:{x:0,y:0}}),mounted(){this._initialize()},watch:{state_class_mapping:{deep:!0,handler(t){this._setClasses()}},states(t){this._renderSketch()},transitions(t){this._renderSketch()}},methods:{onResize(){if(this.svg&&Math.abs(this.windowSize.x-window.innerWidth)>50){this.windowSize={x:window.innerWidth,y:window.innerHeight};var t=ne["select"]("#svg-container").node().getBoundingClientRect().width;ne["select"]("svg").attr("width",t-24),this._reCenterSketch()}},_getChilds(t){return this.transitions.filter(e=>e.source_state_id==t).map(t=>this._get_state_by_id(t.destination_state_id))},_initialize(){if(this.states&&this.states.length>0||this.transitions&&this.transitions.length>0){var t=ne["select"](this.$el);this.svg=t.select("svg"),this.svgGroup=this.svg.append("g"),this.graph=(new re.a.graphlib.Graph).setGraph({}).setDefaultEdgeLabel((function(){return{}})),this._renderSketch(),this.initialized=!0}},_createNode(t,e){this.graph.setNode(t.id,{label:t.label,class:"node-default",id:`state_${t.id}`})},_createEdge(t){this.graph.setEdge(t.source_state_id,t.destination_state_id,{id:`transition_${t.id}`,label:"<<---"})},_destroySketchComponents(){var t=this.graph;this.graph.nodes().forEach((function(e){t.removeNode(e)})),this.graph.edges().forEach((function(e){t.removeEdge(e)})),ne["selectAll"](".clickable-edge").remove()},_renderSketch(){if(this.states.length>0||this.transitions.length>0){this._destroySketchComponents();var t=this;this.states.forEach((e,i)=>{t._createNode(e,i)}),this.transitions.forEach(e=>{t._createEdge(e)}),this._roundNodeCorners();var e=new re.a.render,i=ne["select"](this.$el);e(i.select("svg g"),this.graph),this._reCenterSketch(),this.editable&&this._setNodeOnclicks(),this._setEdgeLabelDefaultClass(),this._setEdgeOnclicks(),this._setClasses()}},_setNodeOnclicks(){var t=this;this.states.forEach(e=>{ne["select"](`g#state_${e.id} rect`).on("click",(function(){t.$emit("on-state-clicked",t._get_state_by_id(e.id))}))})},_setEdgeLabelDefaultClass(){ne["selectAll"]("g.edgeLabels > g.edgeLabel").classed("edge-label-UNSELECTED ",!0)},_setEdgeOnclicks(){var t=this;ne["select"]("g.edgePaths").selectAll("g.edgePath").nodes();this.transitions.forEach((e,i)=>{var a=ne["select"](`g#transition_${e.id}`);a.attr("index",i),a.append("path").attr("d",a.select("path").attr("d")).classed("clickable-edge",!0).on("click",(function(){e&&(t._unselectEdge(),t.selected_transition_id=e.id,t._selectEdge())}))})},_setClasses(){var t=this;this.states.forEach(e=>{t.state_class_mapping&&t.state_class_mapping[e.id]&&(t.state_class_mapping[e.id].rect&&Object.keys(t.state_class_mapping[e.id].rect).forEach(i=>ne["select"](`g#state_${e.id} rect`).style(i,t.state_class_mapping[e.id].rect[i])),t.state_class_mapping[e.id].label&&Object.keys(t.state_class_mapping[e.id].label).forEach(i=>ne["select"](`g#state_${e.id} g.label`).style(i,t.state_class_mapping[e.id].label[i])))})},_getTransitionBy(t,e){return this.transitions.find(i=>i.source_state_id==t.id&&i.destination_state_id==e.id)},_selectEdge(){if(this.selected_transition_id){var t=ne["select"](`g#transition_${this.selected_transition_id}`);t.classed("edge-SELECTED",!0).classed("edge-UNSELECTED",!1);var e=new Number(t.attr("index")),i=ne["selectAll"]("g.edgeLabels > g.edgeLabel").nodes()[e];ne["select"](i).classed("edge-label-SELECTED",!0).classed("edge-label-UNSELECTED",!1),this.$emit("on-transition-selected",this.selected_transition_id)}},_unselectEdge(){if(this.selected_transition_id){var t=ne["select"](`g#transition_${this.selected_transition_id}`);t.classed("edge-SELECTED",!1).classed("edge-UNSELECTED",!0);var e=new Number(t.attr("index")),i=ne["selectAll"]("g.edgeLabels > g.edgeLabel").nodes()[e];ne["select"](i).classed("edge-label-SELECTED",!1).classed("edge-label-UNSELECTED",!0),this.$emit("on-transition-unselected",this.selected_transition_id)}},_reCenterSketch(){var t=(this.svg.attr("width")-this.graph.graph().width)/2;this.svgGroup.attr("transform","translate("+t+", 20)"),this.svg.attr("height",this.graph.graph().height+40)},_roundNodeCorners(){var t=this.graph;this.graph.nodes().forEach((function(e){var i=t.node(e);i.rx=i.ry=5}))},_get_state_by_id(t){return this.states.find(e=>e.id==t)},_get_transition_by_id(t){return this.transitions.find(e=>e.id==t)}}},ce=le,de=(i("6d29"),Object(d["a"])(ce,ae,oe,!1,null,null,null)),ue=de.exports,_e={name:"CreateWorkflowPage",components:{WorkflowIllustration:ue,StateInput:Yt},data:()=>({workflow:null,initialized:!1,selected_transition:null,states:[],transitions:[],transition_approvals:{},selected_state:null,new_transition_state:null,state_class_mapping:{},selected_state_class:{rect:{fill:"deepskyblue"},label:{stroke:"white"}},default_state_class:{rect:{fill:"#dddd"},label:{stroke:"black"}}}),mounted(){var t=this.$route.params.id;this.workflow=P.get(`/workflow/get/${t}/`,e=>{this.workflow=Ct.of(e.data.id,e.data.content_type,e.data.initial_state,e.data.field_name);var i=P.get(`/workflow/state/list/${t}/`,t=>{this.states=t.data.map(t=>$t.of(t.id,t.label))}),a=P.get(`/workflow/transition-meta/list/${t}/`,t=>{this.transitions=t.data.map(t=>St.of(t.id,this.workflow,t.source_state,t.destination_state))});Promise.all([i,a]).then(()=>{this.initialized=!0;var t=JSON.parse(this.$route.query.selected_state||null);t&&this._selected_state(t)})})},methods:{onStateSelected(t){this._selected_state(t)},_selected_state(t){this.selected_state&&this.$set(this.state_class_mapping,this.selected_state.id,this.default_state_class),this.$set(this.state_class_mapping,t.id,this.selected_state_class),this.selected_state=t,this.updateQuery({selected_state:JSON.stringify(this.selected_state)})},createState(){if(this.new_transition_state){var t=Promise.resolve(),e=!1;this.new_transition_state.is_new&&(t=P.post("/state/create/",this.new_transition_state.to_create_request(),t=>{e=!0,this.new_transition_state.is_new=!1,this.new_transition_state.id=t.data.id,this.new_transition_state.final_label=this.new_transition_state.label})),t.then(t=>{var i=this.states.find(t=>t.id==this.selected_state.id),a=St.create(this.workflow,i.id,this.new_transition_state.id);P.post("/transition-meta/create/",a.to_create_request(),t=>{this.states.find(t=>t.id==this.new_transition_state.id)||this.states.push(this.new_transition_state);var i=this.states.find(t=>t.id==a.source_state_id),o=this.states.find(t=>t.id==a.destination_state_id);k(`Transition meta ${i.label} -> ${o.label}${e?" ( New )":""} is created`,2e3),a.is_new=!1,a.id=t.data.id,this.transitions.push(a),this._selected_state(this.new_transition_state),this.new_transition_state=null})})}},updateQuery(t){var e={...this.$route.query,...t},i=this;Object.keys(e).some(t=>i.$route.query[t]!=e[t])&&this.$router.push({query:e})},onTransitionSelected(t){this.selected_transition=this.transitions.find(e=>e.id==t)},goToEditWorkflowRules(){this.$router.push({name:"edit-workflow-rules",params:{id:this.workflow.id}})}}},pe=_e,he=Object(d["a"])(pe,ee,ie,!1,null,null,null),ve=he.exports,fe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.initialized?i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[t._v("\n          Workflow for\n          "),i("v-chip",[t._v(t._s(t.workflow.identifier))])],1)])],1),i("v-row",[i("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[i("v-container",[i("WorkflowIllustration",{attrs:{states:t.states,transitions:t.transitions,editable:!0},on:{"on-transition-selected":t.on_transition_selected}})],1)],1),i("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[t.selected_transition?i("v-container",[i("v-row",[i("v-col",[i("v-card",{staticClass:"pa-5",attrs:{elevation:6}},[i("v-card-title",[i("v-row",[i("v-col",{attrs:{cols:"9"}},[t._v("\n                      Transition steps from\n                      "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("span",{domProps:{textContent:t._s(t.get_state_by(t.selected_transition.source_state_id).label)}})]),t._v("to\n                      "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("span",{domProps:{textContent:t._s(t.get_state_by(t.selected_transition.destination_state_id).label)}})])],1),i("div",{staticClass:"flex-grow-1"}),t.readonly?t._e():i("v-col",[i("v-speed-dial",{attrs:{bottom:!0,right:!0,direction:"left","open-on-hover":!0},scopedSlots:t._u([{key:"activator",fn:function(){return[i("v-btn",{attrs:{color:"primary",dark:"",fab:""},model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[t.fab?i("v-icon",[t._v("mdi-close")]):i("v-icon",[t._v("mdi-plus")])],1)]},proxy:!0}],null,!1,3988453149),model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"green"},on:{click:function(e){t.newTransitionHookDialog=!0}}},a),[i("v-icon",[t._v("mdi-function-variant")])],1)]}}],null,!1,585803449)},[i("span",[t._v("Create Transition Hook")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"green"},on:{click:function(e){t.newApprovalDialog=!0}}},a),[i("v-icon",[t._v("mdi-account-multiple-check")])],1)]}}],null,!1,476429629)},[i("span",[t._v("Create Approval Step")])])],1)],1)],1)],1),i("v-card-text",[i("ApprovalList",{attrs:{workflow:t.workflow,approvals:t.selected_transition.approvals,editable:!t.readonly},on:{"on-delete":t.on_approval_deleted,"on-order-change":t.on_approvals_order_change,"on-hook-create":t.on_approval_hook_created,"on-hook-delete":t.on_approval_hook_deleted}}),t.selected_transition.hooks.length>0?i("div",[i("v-divider"),i("span",{staticClass:"title font-weight-light"},[t._v("Right before the transition happens")]),t._l(t.selected_transition.hooks,(function(e,a){return i("div",{key:e.id},[i("HookDetail",{attrs:{hook:e,editable:!t.readonly},on:{"on-delete":t.on_transition_hook_deleted}})],1)}))],2):t._e()],1)],1)],1)],1)],1):t.readonly?t._e():i("v-container",[i("EmptyState",{attrs:{label:"Select a transition",description:"Selecting a transition by clicking the arrow, you'll be able to create the rules."},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v("mdi-mouse")]},proxy:!0}],null,!1,665517018)})],1)],1)],1)],1):t._e(),!t.readonly&&t.selected_transition?i("v-dialog",{attrs:{"max-width":"800"},model:{value:t.newApprovalDialog,callback:function(e){t.newApprovalDialog=e},expression:"newApprovalDialog"}},[i("CreateApprovalForm",{attrs:{workflow:t.workflow,transition_id:t.selected_transition.id},on:{"on-create":t.on_approval_created}})],1):t._e(),!t.readonly&&t.selected_transition?i("v-dialog",{attrs:{"max-width":"800"},model:{value:t.newTransitionHookDialog,callback:function(e){t.newTransitionHookDialog=e},expression:"newTransitionHookDialog"}},[i("CreateTransitionHookForm",{attrs:{workflow:t.workflow,transition_meta:t.selected_transition.id,excluded_function_ids:t.selected_transition.hooks.map((function(t){return t.callback_function.id}))},on:{"on-create":t.on_transition_hook_created}})],1):t._e()],1)},me=[],ge=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{staticClass:"pa-5",attrs:{elevation:6}},[i("v-card-title",[t._v("New Approval Rule")]),i("v-card-text",[i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.permissions,loading:t.permissions_loading,"search-input":t.search_permissions,"hide-selected":"","item-text":"identifier",label:"Search permissions",clearable:"",chips:"",multiple:"","return-object":""},on:{"update:searchInput":function(e){t.search_permissions=e},"update:search-input":function(e){t.search_permissions=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n                  Start typing to search for the\n                  "),i("strong",[t._v("permissions")])])],1)]},proxy:!0},{key:"selection",fn:function(e){var a=e.attr,o=e.on,n=e.item,s=e.selected;return[i("v-chip",t._g(t._b({staticClass:"white--text",attrs:{"input-value":s,color:"primary"}},"v-chip",a,!1),o),[i("v-icon",{attrs:{left:""}},[t._v("mdi-lock")]),i("span",{domProps:{textContent:t._s(n.identifier)}})],1)]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.identifier)}})],1)]}}]),model:{value:t.selected_permissions,callback:function(e){t.selected_permissions=e},expression:"selected_permissions"}})],1)],1),i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.groups,loading:t.groups_loading,"search-input":t.search_groups,"hide-selected":"","item-text":"name",label:"Search groups",clearable:"",chips:"",multiple:"","return-object":""},on:{"update:searchInput":function(e){t.search_groups=e},"update:search-input":function(e){t.search_groups=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n                  Start typing to search for the\n                  "),i("strong",[t._v("groups")])])],1)]},proxy:!0},{key:"selection",fn:function(e){var a=e.attr,o=e.on,n=e.item,s=e.selected;return[i("v-chip",t._g(t._b({staticClass:"white--text",attrs:{"input-value":s,color:"primary"}},"v-chip",a,!1),o),[i("v-icon",{attrs:{left:""}},[t._v("mdi-account-multiple")]),i("span",{domProps:{textContent:t._s(n.name)}})],1)]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.name)}})],1)]}}]),model:{value:t.selected_groups,callback:function(e){t.selected_groups=e},expression:"selected_groups"}})],1)],1)],1)],1),i("v-card-actions",[i("v-row",[i("v-col",{attrs:{justify:"center",align:"right"}},[i("v-btn",{attrs:{large:"",color:"primary"},on:{click:t.createApproval}},[t._v("Create Approval")])],1)],1)],1)],1)},ke=[],we={name:"CreateApprovalForm",props:["workflow","transition_id"],data:()=>({permissions_loading:!1,groups_loading:!1,selected_permissions:[],selected_groups:[],groups:[],permissions:[],search_permissions:null,search_groups:null}),mounted(){},watch:{selected_permissions(t){this.search_permissions=null},search_permissions(t){!t||this.selected_permissions&&this.selected_permissions.map(t=>t.identifier).includes(t)||(this.permissions_loading=!0,P.get("/permission/list/",t=>{this.permissions=t.data.map(t=>({identifier:t.codename+"."+t.content_type.app_label+"."+t.content_type.model,...t}))}).finally(()=>this.permissions_loading=!1))},selected_groups(t){this.search_groups=null},search_groups(t){!t||this.selected_groups&&this.selected_groups.map(t=>t.name).includes(t)||(this.groups_loading=!0,P.get("/group/list/",t=>this.groups=t.data).finally(()=>this.groups_loading=!1))}},methods:{createApproval(){this.$emit("on-create",Dt.create(this.transition_id,this.workflow,this.selected_permissions,this.selected_groups,this.given_priority)),this.selected_permissions=[],this.selected_groups=[],this.given_priority=0}}},be=we,ye=Object(d["a"])(be,ge,ke,!1,null,null,null),xe=ye.exports,Ce=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{staticClass:"pa-5",attrs:{elevation:6}},[i("v-card-title",[t._v("New Hook")]),i("v-card-text",[i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.functions,loading:t.functions_loading,"search-input":t.search_functions,"hide-selected":"","item-text":"name",label:"Search functions",clearable:"",chips:"","return-object":""},on:{"update:searchInput":function(e){t.search_functions=e},"update:search-input":function(e){t.search_functions=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n                  Start typing to search for the\n                  "),i("strong",[t._v("callback functions")])])],1)]},proxy:!0},{key:"selection",fn:function(e){var a=e.attr,o=e.on,n=e.item,s=e.selected;return[i("v-chip",t._g(t._b({staticClass:"white--text",attrs:{"input-value":s,color:"primary"}},"v-chip",a,!1),o),[i("v-icon",{attrs:{left:""}},[t._v("mdi-function-variant")]),i("span",{domProps:{textContent:t._s(n.name)}})],1)]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.name)}})],1)]}}]),model:{value:t.selected_function,callback:function(e){t.selected_function=e},expression:"selected_function"}})],1)],1)],1)],1),i("v-card-actions",[i("v-row",[i("v-col",{attrs:{justify:"center",align:"right"}},[i("v-btn",{attrs:{large:"",color:"primary"},on:{click:t.createHook}},[t._v("Create Hook")])],1)],1)],1)],1)},je=[],$e={name:"CreateTransitionHookForm",props:["workflow","transition_meta","transition","object_id","excluded_function_ids"],data:()=>({functions_loading:!1,selected_function:null,functions:[],search_functions:null}),mounted(){},watch:{selected_function(t){this.search_functions=null},search_functions(t){!t||this.selected_function&&this.selected_function.name.includes(t)||(this.functions_loading=!0,P.get("/function/list/",t=>this.functions=t.data.map(t=>jt.of(t.id,t.name,t.body)).filter(t=>!this.excluded_function_ids.includes(t.id))).finally(()=>this.functions_loading=!1))}},methods:{createHook(){var t=Et.create(this.workflow,this.selected_function,this.transition_meta,this.transition,this.object_id);this.$emit("on-create",t),this.selected_function=null}}},Se=$e,De=Object(d["a"])(Se,Ce,je,!1,null,null,null),Ee=De.exports,Te=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",[i("v-card-title",{class:t.hook.is_executed?"executed":t.editable?"":"not-editable"},[i("v-icon",{staticClass:"mb-1 mr-3"},[t._v("mdi-function-variant")]),t.hook.is_executed?i("span",{staticClass:"title font-weight-light"},[t._v("\n      Executed function\n      "),i("v-chip",{staticClass:"black--text"},[t._v(t._s(t.hook.callback_function.name))])],1):i("span",{staticClass:"title font-weight-light"},[t._v("\n      Execute function\n      "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[t._v(t._s(t.hook.callback_function.name))])],1),i("div",{staticClass:"flex-grow-1"}),t.editable&&!t.hook.is_executed?i("v-btn",{attrs:{text:"",icon:"",color:"warning"},on:{click:function(e){return t.deleteStep()}}},[i("v-icon",[t._v("mdi-delete")])],1):t._e()],1)],1)},He=[],Ae={name:"HookDetail",props:["hook","editable"],methods:{deleteStep(){this.$emit("on-delete",this.hook)}}},Oe=Ae,Pe=(i("d21c"),Object(d["a"])(Oe,Te,He,!1,null,null,null)),We=Pe.exports,ze=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{staticClass:"py-4",attrs:{fluid:""}},[0==t.items.length?i("v-row",[i("v-col",[t._v("No approval step")])],1):i("v-row",[i("v-col",[i("Container",{attrs:{"group-name":"column","drag-handle-selector":".column-drag-handle","drag-class":"opacity-ghost","drop-class":"opacity-ghost-drop"},on:{drop:function(e){return t.on_drop(e)}}},t._l(t.items,(function(e){return i("Draggable",{key:e.priority},[i("div",{staticClass:"draggable-item"},[i("ApprovalDetail",{attrs:{workflow:t.workflow,editable:t.editable,approval:e},on:{"on-delete":t.delete_approval,"on-hook-create":function(e){return t.on_hook_created(e)},"on-hook-delete":function(e){return t.on_hook_deleted(e)}}})],1)])})),1)],1)],1)],1)},qe=[],Le=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",[i("v-card",[i("v-card-title",[t.editable?i("v-icon",{staticClass:"column-drag-handle mb-1 mr-3"},[t._v("mdi-menu")]):t._e(),i("v-icon",{staticClass:"mb-1 mr-3"},[t._v("mdi-account-multiple-check")]),i("span",{staticClass:"title font-weight-light"},[t._v("Should be approved by the users who")]),i("div",{staticClass:"flex-grow-1"}),t.editable?i("v-speed-dial",{staticClass:"mt-5",attrs:{bottom:!0,right:!0,direction:"left","open-on-hover":!0},scopedSlots:t._u([{key:"activator",fn:function(){return[i("v-btn",{attrs:{small:"",color:"primary",dark:"",fab:""},model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[t.fab?i("v-icon",[t._v("mdi-close")]):i("v-icon",[t._v("mdi-settings")])],1)]},proxy:!0}],null,!1,4126577419),model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"green"},on:{click:function(e){t.newHookDialog=!0}}},a),[i("v-icon",[t._v("mdi-function-variant")])],1)]}}],null,!1,3244165398)},[i("span",[t._v("Create Approval Hook")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"warning"},on:{click:function(e){return t.delete_approval()}}},a),[i("v-icon",[t._v("mdi-delete")])],1)]}}],null,!1,2737557744)},[i("span",[t._v("Delete Approval Step")])])],1):t._e()],1),i("v-card-text",[i("v-row",[i("v-col",[t.approval.permissions.length>0?i("v-row",{staticClass:"permissions-lane"},[i("v-col",{attrs:{cols:"4"}},[i("label",[t._v("have permissions:")])]),i("v-col",t._l(t.approval.permissions,(function(e,a){return i("span",{key:e.id},[i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-lock")]),i("span",{domProps:{textContent:t._s(e.identifier)}})],1),a!=t.approval.permissions.length-1?i("span",[t._v("or")]):t._e()],1)})),0)],1):t._e(),t.approval.groups.length>0?i("v-row",{staticClass:"groups-lane"},[i("v-col",{attrs:{cols:"4"}},[i("label",[t._v("are in groups:")])]),i("v-col",t._l(t.approval.groups,(function(e,a){return i("span",{key:e.id},[i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-account-multiple")]),i("span",{domProps:{textContent:t._s(e.name)}})],1),a!=t.approval.groups.length-1?i("span",[t._v("or")]):t._e()],1)})),0)],1):t._e(),i("v-row",[t.approval.hooks.length>0?i("v-container",{attrs:{fluid:""}},[i("v-divider"),i("span",{staticClass:"title font-weight-light"},[t._v("Right after this is approved")]),t._l(t.approval.hooks,(function(e){return i("div",{key:e.id,staticClass:"my-2"},[i("HookDetail",{attrs:{hook:e,editable:t.editable},on:{"on-delete":function(){return t.on_hook_deleted(e)}}})],1)}))],2):t._e()],1)],1)],1)],1)],1),i("v-dialog",{attrs:{"max-width":"800"},model:{value:t.newHookDialog,callback:function(e){t.newHookDialog=e},expression:"newHookDialog"}},[i("CreateApprovalHookForm",{attrs:{workflow:t.workflow,transition_approval_meta_id:t.approval.id,excluded_function_ids:t.approval.hooks.map((function(t){return t.callback_function.id}))},on:{"on-create":t.on_hook_created}})],1)],1)},Fe=[],Ne=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{staticClass:"pa-5",attrs:{elevation:6}},[i("v-card-title",[t._v("New Hook")]),i("v-card-text",[i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.functions,loading:t.functions_loading,"search-input":t.search_functions,"hide-selected":"","item-text":"name",label:"Search functions",clearable:"",chips:"","return-object":""},on:{"update:searchInput":function(e){t.search_functions=e},"update:search-input":function(e){t.search_functions=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("v-list-item",[i("v-list-item-title",[t._v("\n                  Start typing to search for the\n                  "),i("strong",[t._v("callback functions")])])],1)]},proxy:!0},{key:"selection",fn:function(e){var a=e.attr,o=e.on,n=e.item,s=e.selected;return[i("v-chip",t._g(t._b({staticClass:"white--text",attrs:{"input-value":s,color:"primary"}},"v-chip",a,!1),o),[i("v-icon",{attrs:{left:""}},[t._v("mdi-function-variant")]),i("span",{domProps:{textContent:t._s(n.name)}})],1)]}},{key:"item",fn:function(e){var a=e.item;return[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:t._s(a.name)}})],1)]}}]),model:{value:t.selected_function,callback:function(e){t.selected_function=e},expression:"selected_function"}})],1)],1)],1)],1),i("v-card-actions",[i("v-row",[i("v-col",{attrs:{justify:"center",align:"right"}},[i("v-btn",{attrs:{large:"",color:"primary"},on:{click:t.createHook}},[t._v("Create Hook")])],1)],1)],1)],1)},Ie=[],Re={name:"CreateApprovalHookForm",props:["workflow","transition_approval_meta_id","object_id","transition_approval_id","excluded_function_ids"],data:()=>({functions_loading:!1,selected_function:null,functions:[],search_functions:null}),mounted(){},watch:{selected_function(t){this.search_functions=null},search_functions(t){!t||this.selected_function&&this.selected_function.name.includes(t)||(this.functions_loading=!0,P.get("/function/list/",t=>this.functions=t.data.map(t=>jt.of(t.id,t.name,t.body)).filter(t=>!this.excluded_function_ids.includes(t.id))).finally(()=>this.functions_loading=!1))}},methods:{createHook(){var t=Tt.create(this.workflow,this.selected_function,this.transition_approval_meta_id,this.transition_approval_id,this.object_id);this.$emit("on-create",t),this.selected_function=null}}},Me=Re,Ue=Object(d["a"])(Me,Ne,Ie,!1,null,null,null),Ge=Ue.exports,Je={name:"ApprovalDetail",components:{HookDetail:We,CreateApprovalHookForm:Ge},props:["workflow","approval","editable"],data:()=>({fab:!1,newHookDialog:!1}),methods:{delete_approval(){this.$emit("on-delete",this.approval)},on_hook_created(t){this.$emit("on-hook-create",t),this.newHookDialog=!1},on_hook_deleted(t){this.$emit("on-hook-delete",t)}}},Ve=Je,Be=Object(d["a"])(Ve,Le,Fe,!1,null,null,null),Qe=Be.exports,Ye=i("3f7d"),Ke={name:"ApprovalList",components:{ApprovalDetail:Qe,HookDetail:We,Container:Ye["Container"],Draggable:Ye["Draggable"]},props:["workflow","approvals","editable"],data:()=>({drag:!1,items:[]}),computed:{dragOptions(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},watch:{approvals(t){t!=this.items&&this.update_items()}},mounted(){this.update_items()},methods:{on_move(){this.items=this.items.map((t,e)=>{return t.priority=e+1,t}),this.$emit("on-order-change",this.items)},delete_approval(t){this.$emit("on-delete",t)},update_items(){this.items=this.approvals.map((t,e)=>({...t,priority:e+1}))},on_hook_created(t){this.$emit("on-hook-create",t)},on_hook_deleted(t){this.$emit("on-hook-delete",t)},on_drop(t){this.items=this.apply_drag(this.items,t).map((t,e)=>({...t,priority:e+1})),this.$emit("on-order-change",this.items)},apply_drag(t,e){const{removedIndex:i,addedIndex:a,payload:o}=e;if(null===i&&null===a)return t;const n=[...t];let s=o;return null!==i&&(s=n.splice(i,1)[0]),null!==a&&n.splice(a,0,s),n}}},Xe=Ke,Ze=(i("2af9"),Object(d["a"])(Xe,ze,qe,!1,null,null,null)),ti=Ze.exports,ei={name:"EditWorkflowRulesPage",components:{EmptyState:mt,CreateApprovalForm:xe,CreateTransitionHookForm:Ee,WorkflowIllustration:ue,ApprovalList:ti,HookDetail:We},props:["readonly"],data:()=>({newApprovalDialog:!1,newTransitionHookDialog:!1,fab:!1,workflow:null,initialized:!1,selected_transition:null,states:[],transitions:[],alert_timeout:2e3}),mounted(){var t=this.$route.params.id;this.workflow=P.get(`/workflow/get/${t}/`,e=>{this.workflow=Ct.of(e.data.id,e.data.content_type,e.data.initial_state,e.data.field_name);var i=this.get_states(t).then(t=>this.states=t),a=this.get_transition_metas(t).then(t=>this.transitions=t);Promise.all([i,a]).then(()=>{var t=this.$route.query.selected_transition_id;t&&this.on_transition_selected(t),this.initialized=!0})})},methods:{get_states(t){return P.get(`/workflow/state/list/${t}/`,t=>{return t.data.map(t=>$t.of(t.id,t.label))})},get_transition_metas(t){var e=this;return P.get(`/workflow/transition-meta/list/${t}/`,t=>{return Promise.all(t.data.map(t=>{var i=St.of(t.id,this.workflow,t.source_state,t.destination_state),a=e.get_transition_approval_metas(i.id).then(t=>{i.approvals=t}),o=e.get_transition_hooks(i.id).then(t=>{i.hooks=t});return Promise.all([a,o]).then(()=>i)}))})},get_transition_hooks(t){return P.get(`/transition-meta/transition-hook/list/${t}/`,t=>{return t.data.map(t=>Et.of(t.id,this.workflow,t.callback_function,t.transition_meta,t.transition,t.object_id,!1))})},get_transition_approval_metas(t){var e=this;return P.get(`/transition-meta/transition-approval-meta/list/${t}/`,t=>{return Promise.all(t.data.map(t=>{var i=Dt.of(t.id,this.workflow,t.transition,t.permissions,t.groups);return e.get_transition_approval_hooks(i.id).then(t=>{i.hooks=t}).then(()=>i)}))})},get_transition_approval_hooks(t){return P.get(`/transition-approval-meta/approval-hook/list/${t}/`,t=>{return t.data.map(t=>Tt.of(t.id,this.workflow,t.callback_function,t.transition_approval_meta,t.transition_approval,t.object_id,!1))})},on_approval_created(t){if(this.selected_transition){var e=this.selected_transition.approvals.reduce((t,e)=>Math.max(t,e.priority),0);t.priority=e+1,P.post("/transition-approval-meta/create/",t.to_create_request(),e=>{t.id=e.data.id,this.selected_transition.approvals.push(t),this._update_transition(this.selected_transition),this.newApprovalDialog=!1,k("The transition approval meta is created",this.alert_timeout)})}},on_approval_deleted(t){this.selected_transition&&P.delete(`/transition-approval-meta/delete/${t.id}/`,e=>{this.selected_transition.approvals=this.selected_transition.approvals.filter(e=>e.id!=t.id),this._update_transition(this.selected_transition),k("The transition approval meta is deleted",this.alert_timeout)})},on_approvals_order_change(t){P.post("/transition-approval-meta/re-prioritize/",t.map(t=>({transition_approval_meta_id:t.id,priority:t.priority}))).then(e=>{this.selected_transition.approvals=t,this._update_transition(this.selected_transition),k("Re-prioritization has been applied",this.alert_timeout)})},on_transition_hook_created(t){this.selected_transition&&!this.selected_transition.hooks.find(e=>e.id==t.id)&&P.post("/transition-hook/create/",t.to_create_request(),e=>{t.id=e.data.id,this.selected_transition.hooks.push(t),this._update_transition(this.selected_transition),this.newTransitionHookDialog=!1,k("The transition hook is created",this.alert_timeout)})},on_transition_hook_deleted(t){this.selected_transition&&P.delete(`/transition-hook/delete/${t.id}/`,e=>{this.selected_transition.hooks=this.selected_transition.hooks.filter(e=>e.id!=t.id),this._update_transition(this.selected_transition),k("The transition hook is deleted",this.alert_timeout)})},on_approval_hook_created(t){if(this.selected_transition){var e=this.selected_transition.approvals.find(e=>e.id==t.transition_approval_meta_id);e&&!e.hooks.find(e=>e.id==t.id)&&P.post("/approval-hook/create/",t.to_create_request(),i=>{t.id=i.data.id,e.hooks.push(t),this._update_approval(this.selected_transition,e),this._update_transition(this.selected_transition),k("The approval hook is created",this.alert_timeout)})}},on_approval_hook_deleted(t){if(this.selected_transition){var e=this.selected_transition.approvals.find(e=>e.id==t.transition_approval_meta_id);e&&P.delete(`/approval-hook/delete/${t.id}/`,i=>{e.hooks=e.hooks.filter(e=>e.id!=t.id),this._update_approval(this.selected_transition,e),this._update_transition(this.selected_transition),k("The approval hook is deleted",this.alert_timeout)})}},on_transition_selected(t){this.selected_transition=this.transitions.find(e=>e.id==t),this._update_query({selected_transition_id:JSON.stringify(t)})},get_state_by(t){return this.states.find(e=>e.id==t)},_update_transition(t){this.transitions=this.transitions.map(e=>e.id==t.id?t:e)},_update_approval(t,e){t.approvals=t.approvals.map(t=>t.id==e.id?e:t)},_update_query(t){var e={...this.$route.query,...t},i=this;Object.keys(e).some(t=>i.$route.query[t]!=e[t])&&this.$router.push({query:e})},_repriotise_approvals(t){t.approvals=t.approvals.sort((t,e)=>t.priority-e.priority).map((t,e)=>{var i={...t,priority:e+1};return i})}}},ii=ei,ai=(i("86de"),Object(d["a"])(ii,fe,me,!1,null,null,null)),oi=ai.exports,ni=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-function-variant")]),t._v(" Functions\n      ")],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.items,"items-per-page":10},scopedSlots:t._u([{key:"item.action",fn:function(e){var a=e.item;return[i("v-icon",{staticClass:"mr-1",attrs:{color:"primary"},on:{click:function(e){return t.goToViewFunctionPage(a.id)}}},[t._v("mdi-details")]),i("v-icon",{staticClass:"mr-1",attrs:{color:"primary",disabled:!t.has_change_function_permission},on:{click:function(e){return t.goToEditFunctionPage(a.id)}}},[t._v("mdi-pencil")]),i("v-icon",{staticClass:"mr-1",attrs:{color:"warning",disabled:!t.has_delete_function_permission},on:{click:function(e){return t.showDeletingDialog(a)}}},[t._v("mdi-delete")])]}}])})],1)],1),t.has_add_function_permission?i("div",{staticClass:"fab_container"},[i("v-btn",{attrs:{large:"",color:"primary",dark:"",fab:""},on:{click:t.goToCreateFunctionPage}},[i("v-icon",[t._v("mdi-plus")])],1)],1):t._e(),this.deletingFunction?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("\n        Delete function\n        "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-function-variant")]),t._v("\n          "+t._s(t.deletingFunction.name)+"\n        ")],1),t._v("?\n      ")],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.deleteFunction()}}},[t._v("Agree")])],1)],1)],1):t._e()],1)},si=[],ri={name:"ListCallbackFunctionPage",data:()=>({deletingFunction:null,deleteDialog:!1,headers:[{text:"Name",value:"name",align:"left"},{text:"Version",value:"version",align:"left"},{text:"Created At",value:"date_created",align:"left"},{text:"Last Updated At",value:"date_updated",align:"left"},{text:"Actions",value:"action",sortable:!1}],items:[],has_add_function_permission:!1,has_delete_function_permission:!1,has_change_function_permission:!1}),mounted(){this.fetchFunctions()},methods:{setAlertMessage(t){this.message=t,this.messageAlert=!0;var e=this;setTimeout(()=>e.messageAlert=!1,3e3)},fetchFunctions(){var t=P.get("/function/list/",t=>{this.items=t.data.map(t=>({...t,version:`v${t.version}`}))}),e=M.has_add_permission(I,t=>{this.has_add_function_permission=t}),i=M.has_change_permission(I,t=>{this.has_change_function_permission=t}),a=M.has_delete_permission(I,t=>{this.has_delete_function_permission=t});Promise.all([t,e,i,a]).then(()=>this.initialized=!0)},goToCreateFunctionPage(){this.$router.push({name:"create-callback-function"})},goToViewFunctionPage(t){this.$router.push({name:"view-callback-function",params:{id:t}})},goToEditFunctionPage(t){this.$router.push({name:"edit-callback-function",params:{id:t}})},showDeletingDialog(t){this.deletingFunction=t,this.deleteDialog=!0},deleteFunction(){this.deletingFunction&&P.delete(`/function/delete/${this.deletingFunction.id}/`,()=>{this.fetchFunctions(),this.deleteDialog=!1,k(`Function '${this.deletingFunction.name}' is deleted`)})}}},li=ri,ci=(i("c391"),Object(d["a"])(li,ni,si,!1,null,null,null)),di=ci.exports,ui=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-function-variant")]),t._v("Create Callback Function\n        ")],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-row",[i("v-col",[i("v-text-field",{attrs:{label:"Callback function name","prepend-icon":"mdi-function-variant",rules:t.functionNameRules,required:""},model:{value:t.callback_function_name,callback:function(e){t.callback_function_name=e},expression:"callback_function_name"}})],1)],1),i("v-row",[i("v-col",[i("CodeEditor",{model:{value:t.callback_function_body,callback:function(e){t.callback_function_body=e},expression:"callback_function_body"}})],1)],1)],1)],1),i("v-row",[i("v-col",{attrs:{justify:"center",align:"right"}},[i("v-btn",{attrs:{large:"",color:"primary"},on:{click:t.publish}},[i("v-icon",[t._v("mdi-content-save")]),t._v("Save\n        ")],1)],1)],1)],1)],1)},_i=[],pi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("codemirror",{attrs:{value:t.value,options:t.cmOptions},on:{ready:t.onCmReady,input:t.onCmCodeChange}})},hi=[],vi=i("8f94"),fi=i("56b3"),mi=i.n(fi);function gi(t){mi.a.registerHelper("hint","python",(function(e){if("python"==e.getMode().name){var i="and del from not while as elif global or with assert else if pass yieldbreak except import print class exec in raise continue finally is return def for lambda try",a=i.split(" "),o=i.toUpperCase().split(" "),n="abs divmod input open staticmethod all enumerate int ord str any eval isinstance pow sum basestring execfile issubclass print superbin file iter property tuple bool filter len range typebytearray float list raw_input unichr callable format locals reduce unicodechr frozenset long reload vars classmethod getattr map repr xrangecmp globals max reversed zip compile hasattr memoryview round __import__complex hash min set apply delattr help next setattr bufferdict hex object slice coerce dir id oct sorted intern "+t,s=n.split(" ").join("() ").split(" "),r=n.toUpperCase().split(" ").join("() ").split(" ");return u(e,o,(function(t,e){return t.getTokenAt(e)}))}function l(t,e){for(var i=0,a=t.length;i<a;++i)e(t[i])}function c(t,e){if(!Array.prototype.indexOf){var i=t.length;while(i--)if(t[i]===e)return!0;return!1}return-1!=t.indexOf(e)}function d(t,e){var i=[],n=t.string;function d(t){0!=t.indexOf(n)||c(i,t)||i.push(t)}function u(t){l(s,d),l(r,d),l(a,d),l(o,d)}if(e){var _,p=e.pop();"variable"==p.type?_=p.string:"variable-3"==p.type&&(_=":"+p.string);while(null!=_&&e.length)_=_[e.pop().string];null!=_&&u(_)}return i}function u(t,e,i){var a=t.getCursor(),o=i(t,a),n=o;if(/^[\w$_]*$/.test(o.string)||(o=n={start:a.ch,end:a.ch,string:"",state:o.state,className:":"==o.string?"python-type":null}),!s)var s=[];s.push(n);var r=d(o,s);return r=r.sort(),1==r.length&&r.push(" "),{list:r,from:mi.a.Pos(a.line,o.start),to:mi.a.Pos(a.line,o.end)}}}))}i("a7be"),i("db91"),i("8c2e"),i("31c5"),i("99488"),i("b933"),i("9b74"),i("f6b6"),i("9c7b"),i("715d"),i("23de"),i("4ba6"),i("8c33"),i("7289"),i("2aed"),i("d72f"),i("0b6c"),i("9a48");var ki={name:"CodeEditor",components:{codemirror:vi["codemirror"]},props:["value","read_only","default_value","extra_keywords"],mounted(){gi(this.extra_keywords||[])},data:function(){return{cmOptions:{tabSize:4,styleActiveLine:!1,lineNumbers:!0,styleSelectedText:!1,line:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],mode:"text/x-python",hintOptions:{completeSingle:!1},keyMap:"sublime",matchBrackets:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete"},readOnly:!!this.read_only&&"nocursor"}}},methods:{onCmCodeChange(t){this.$emit("input",t)},onCmReady(t){t.on("keypress",()=>{t.showHint()})}}},wi=ki,bi=Object(d["a"])(wi,pi,hi,!1,null,null,null),yi=bi.exports,xi={name:"CreateCallbackFunctionPage",components:{CodeEditor:yi},data:()=>({valid:!0,callback_function_name:null,callback_function_body:null,functionNameRules:[t=>!!t||"Function name is required",t=>t&&t.length<=200||"Name must be less than 200 characters"]}),methods:{publish(){this.$refs.form.validate()&&P.post("/function/create/",{name:this.callback_function_name,body:this.callback_function_body},()=>{k(`Function '${this.callback_function_name}' is created`),this.$router.push({name:"list-callback-functions"})})}}},Ci=xi,ji=Object(d["a"])(Ci,ui,_i,!1,null,null,null),$i=ji.exports,Si=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.callback_function?i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-function-variant")]),t._v("Callback Function Detail\n      ")],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-row",[i("v-col",{attrs:{cols:"auto"}},[i("label",[i("h3",[t._v("Name:")])])]),i("v-col",[i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-function-variant")]),i("span",{domProps:{textContent:t._s(t.callback_function.name)}})],1)],1)],1),i("v-row",[i("v-col",[i("CodeEditor",{attrs:{read_only:!0},model:{value:t.callback_function.body,callback:function(e){t.$set(t.callback_function,"body",e)},expression:"callback_function.body"}})],1)],1)],1)],1)],1):t._e()},Di=[],Ei={name:"CreateCallbackFunctionPage",components:{CodeEditor:yi},data:()=>({callback_function:null}),mounted(){var t=this.$route.params.id;P.get(`/function/get/${t}/`,t=>this.callback_function=t.data)},methods:{}},Ti=Ei,Hi=Object(d["a"])(Ti,Si,Di,!1,null,null,null),Ai=Hi.exports,Oi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-function-variant")]),t._v("Edit Callback Function\n        ")],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-row",[i("v-col",[i("v-text-field",{attrs:{label:"Callback function name","prepend-icon":"mdi-function-variant",rules:t.functionNameRules,required:""},model:{value:t.callback_function_name,callback:function(e){t.callback_function_name=e},expression:"callback_function_name"}})],1)],1),i("v-row",[i("v-col",[i("CodeEditor",{model:{value:t.callback_function_body,callback:function(e){t.callback_function_body=e},expression:"callback_function_body"}})],1)],1)],1)],1),i("v-row",[i("v-col",{attrs:{justify:"center",align:"right"}},[i("v-btn",{attrs:{large:"",color:"primary"},on:{click:t.publish}},[i("v-icon",[t._v("mdi-content-save")]),t._v("Update\n        ")],1)],1)],1)],1)],1)},Pi=[],Wi={name:"CreateCallbackFunctionPage",components:{CodeEditor:yi},data:()=>({valid:!0,callback_function_name:null,callback_function_body:null,functionNameRules:[t=>!!t||"Function name is required",t=>t&&t.length<=200||"Name must be less than 200 characters"]}),mounted(){var t=this.$route.params.id;P.get(`/function/get/${t}/`,t=>{console.log(t),this.callback_function_name=t.data.name,this.callback_function_body=t.data.body})},methods:{publish(){if(this.$refs.form.validate()){var t=this.$route.params.id;P.put(`/function/update/${t}/`,{name:this.callback_function_name,body:this.callback_function_body},()=>{k(`Function '${this.callback_function_name}' is updated`),this.$router.push({name:"list-callback-functions"})})}}}},zi=Wi,qi=Object(d["a"])(zi,Oi,Pi,!1,null,null,null),Li=qi.exports,Fi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.initialized?i("v-container",{attrs:{fluid:""}},[i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[t._v("\n          Workflow objects of\n          "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-sitemap")]),i("span",{domProps:{textContent:t._s(t.workflow.identifier)}})],1)],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.workflow_objects,"items-per-page":10},scopedSlots:t._u([{key:"item.action",fn:function(e){var a=e.item;return[i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[i("v-icon",t._g({staticClass:"mr-1",attrs:{color:"primary",disabled:!t.has_change_workflow_permission},on:{click:function(e){return t.goToTimeline(a)}}},o),[t._v("mdi-timeline-text")])]}}],null,!0)},[i("span",[t._v("View Timeline")])]),i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[i("v-btn",t._g({attrs:{icon:"",color:"warning",disabled:!t.has_delete_workflow_permission},on:{click:function(e){return t.showDeletingDialog(a)}}},o),[i("v-icon",[t._v("mdi-delete")])],1)]}}],null,!0)},[i("span",[t._v("Delete Workflow Object")])])]}}],null,!1,4064508329)})],1)],1)],1),this.deletingWorkflowObject?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("\n        Delete workflow object  \n        "),i("v-chip",{attrs:{color:"primary"}},[t._v(t._s(t.deletingWorkflowObject.identifier))]),t._v("  ?\n      ")],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.deleteWorkflowObject()}}},[t._v("Agree")])],1)],1)],1):t._e()],1):t._e()},Ni=[],Ii={name:"ListWorkflowObjectsPage",components:{EmptyState:mt,WorkflowIllustration:ue},data:()=>({initialized:!1,workflow_loading:!1,workflow:null,headers:null,deletingWorkflowObject:null,deleteDialog:!1,workflow_objects:[],has_delete_workflow_permission:!1,has_change_workflow_permission:!1}),watch:{$route(t,e){t.params.workflow_id!=e.params.workflow_id&&this.load()}},mounted(){this.load()},methods:{load(){this.initialized=!1;var t=this.$route.params.workflow_id,e=P.get(`/workflow/get/${t}/`,t=>this.workflow=Ct.of(t.data.id,t.data.content_type,t.data.initial_state,t.data.field_name)),i=M.has_change_permission(F,t=>{this.has_change_workflow_permission=t}),a=M.has_delete_permission(F,t=>{this.has_delete_workflow_permission=t});Promise.all([e,i,a]).then(()=>this.fetchWorkflowObjects()).then(()=>this.initialized=!0).finally(()=>this.workflow_loading=!1)},goToCreateWorkflowPage(){this.$router.push({name:"create-workflow"})},fetchWorkflowObjects(){return this.workflow_object_loading=!0,P.get(`/workflow/object/list/${this.workflow.id}/`,t=>{this.headers=t.data.headers.map(t=>({text:t,value:t,align:"left"})).concat([{text:"Actions",value:"action",sortable:!1}]),this.workflow_objects=t.data.workflow_objects.map(t=>({...t,identifier:t.__str}))}).finally(()=>this.workflow_object_loading=!1)},goToTimeline(t){this.$router.push({name:"edit-workflow-object-timeline",params:{workflow_id:this.workflow.id,object_id:t.pk}})},showDeletingDialog(t){this.deletingWorkflowObject=t,this.deleteDialog=!0},deleteWorkflowObject(){this.deletingWorkflowObject&&P.delete(`/workflow-object/delete/${this.workflow.id}/${this.deletingWorkflowObject.id}/`,()=>{this.fetchWorkflowObjects(),this.deleteDialog=!1,k(`Workflow object ${this.deletingWorkflowObject.identifier} is deleted.`)})},_updateQuery(t){var e={...this.$route.query,...t},i=this;Object.keys(e).some(t=>i.$route.query[t]!=e[t])&&this.$router.push({query:e})}}},Ri=Ii,Mi=Object(d["a"])(Ri,Fi,Ni,!1,null,null,null),Ui=Mi.exports,Gi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.initialized?i("div",[t.states&&t.transitions?i("v-container",{attrs:{fluid:""}},[i("v-row",{staticClass:"mb-6",attrs:{justify:"center",align:"center"}},[i("h1",[t._v("\n        Active Workflow for\n        "),i("v-chip",[t._v(t._s(t.object_identifier))])],1)]),i("v-row",[i("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[i("v-container",[i("WorkflowIllustration",{attrs:{states:t.states,transitions:t.transitions,editable:!1,state_class_mapping:t.state_class_mapping},on:{"on-transition-selected":t.on_transition_selected}})],1)],1),i("v-flex",{attrs:{xs12:"",sm12:"",md6:""}},[t.selected_transition&&!t.selected_transition.is_cancelled?i("v-container",[i("v-row",[i("v-col",[i("v-card",{staticClass:"pa-5",attrs:{elevation:6}},[i("v-card-title",[i("v-row",[i("v-col",{attrs:{cols:"9"}},[t._v("\n                      Transition steps from\n                      "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("span",{domProps:{textContent:t._s(t.get_state_by(t.selected_transition.source_state_id).label)}})]),t._v("to\n                      "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("span",{domProps:{textContent:t._s(t.get_state_by(t.selected_transition.destination_state_id).label)}})])],1),i("div",{staticClass:"flex-grow-1"}),t.selected_transition.is_done||t.readonly?t._e():i("v-col",[i("v-speed-dial",{attrs:{bottom:!0,right:!0,direction:"left","open-on-hover":!0},scopedSlots:t._u([{key:"activator",fn:function(){return[i("v-btn",{attrs:{color:"primary",dark:"",fab:""},model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[t.fab?i("v-icon",[t._v("mdi-close")]):i("v-icon",[t._v("mdi-plus")])],1)]},proxy:!0}],null,!1,3988453149),model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"green"},on:{click:function(e){t.newTransitionHookDialog=!0}}},a),[i("v-icon",[t._v("mdi-function-variant")])],1)]}}],null,!1,585803449)},[i("span",[t._v("Create Transition Hook")])])],1)],1)],1)],1),i("v-card-text",[i("ObjectApprovalList",{attrs:{workflow:t.workflow,object_id:t.$route.params.object_id,object_approvals:t.selected_transition.approvals,editable:!t.readonly},on:{"on-hook-create":t.on_approval_hook_created,"on-hook-delete":t.on_approval_hook_deleted}}),t.selected_transition.hooks.length>0?i("div",[i("v-divider"),i("span",{staticClass:"title font-weight-light"},[t._v("Right before the transition happens")]),t._l(t.selected_transition.hooks,(function(e){return i("div",{key:e.id},[i("HookDetail",{staticClass:"my-1",attrs:{hook:e,editable:!e.is_from_upstream()&&!t.readonly},on:{"on-delete":t.on_transition_hook_deleted}})],1)}))],2):t._e()],1)],1)],1)],1)],1):i("v-container",[i("EmptyState",{attrs:{label:"Select an uncancelled transition",description:"Selecting a transition by clicking the arrow, you'll be able to create transition steps."},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v("mdi-mouse")]},proxy:!0}],null,!1,665517018)})],1)],1)],1)],1):t._e(),!t.readonly&&t.selected_transition?i("v-dialog",{attrs:{"max-width":"800"},model:{value:t.newTransitionHookDialog,callback:function(e){t.newTransitionHookDialog=e},expression:"newTransitionHookDialog"}},[i("CreateTransitionHookForm",{attrs:{workflow:t.workflow,transition_meta:t.selected_transition.transition_meta,transition:t.selected_transition.id,object_id:t.$route.params.object_id,excluded_function_ids:t.selected_transition.hooks.map((function(t){return t.callback_function.id}))},on:{"on-create":t.on_transition_hook_created}})],1):t._e(),t.deletingApprovalHook?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deletingApprovalHookDialog,callback:function(e){t.deletingApprovalHookDialog=e},expression:"deletingApprovalHookDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Delete approval hook?")]),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deletingApprovalHookDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.delete_approval_hook()}}},[t._v("Agree")])],1)],1)],1):t._e(),t.deletingTransitionHook?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deletingTransitionHookDialog,callback:function(e){t.deletingTransitionHookDialog=e},expression:"deletingTransitionHookDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Delete transition hook?")]),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deletingTransitionHookDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.delete_transition_hook()}}},[t._v("Agree")])],1)],1)],1):t._e()],1):t._e()},Ji=[],Vi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{staticClass:"py-4",attrs:{fluid:""}},[0==t.object_approvals.length?i("v-row",[i("v-col",[t._v("No approval step")])],1):i("v-row",[i("v-col",t._l(t.items,(function(e){return i("div",{key:e.priority},[i("ObjectApprovalDetail",{attrs:{workflow:t.workflow,object_id:t.object_id,approval:e,editable:t.editable},on:{"on-hook-create":function(e){return t.on_hook_created(e)},"on-hook-delete":function(e){return t.on_hook_deleted(e)}}})],1)})),0)],1)],1)},Bi=[],Qi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",[i("v-card",["approved"==t.approval.status?i("v-card-title",{staticClass:"approved"},[i("span",{staticClass:"title font-weight-light"},[t._v("Approved by  ")]),i("v-chip",{staticClass:"black--text"},[i("v-icon",{attrs:{left:""}},[t._v("mdi-account")]),i("span",{domProps:{textContent:t._s(t.approval.transactioner.username)}})],1)],1):i("v-card-title",[i("v-icon",{staticClass:"mb-1 mr-3"},[t._v("mdi-account-multiple-check")]),i("span",{staticClass:"title font-weight-light"},[t._v("Should be approved by the users who")]),i("div",{staticClass:"flex-grow-1"}),t.editable?i("v-speed-dial",{staticClass:"mt-5",attrs:{bottom:!0,right:!0,direction:"left","open-on-hover":!0},scopedSlots:t._u([{key:"activator",fn:function(){return[i("v-btn",{attrs:{small:"",color:"primary",dark:"",fab:""},model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[t.fab?i("v-icon",[t._v("mdi-close")]):i("v-icon",[t._v("mdi-settings")])],1)]},proxy:!0}],null,!1,4126577419),model:{value:t.fab,callback:function(e){t.fab=e},expression:"fab"}},[i("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-btn",t._g({attrs:{fab:"",dark:"",small:"",color:"green"},on:{click:function(e){t.newHookDialog=!0}}},a),[i("v-icon",[t._v("mdi-function-variant")])],1)]}}],null,!1,3244165398)},[i("span",[t._v("Create Approval Hook")])])],1):t._e()],1),"approved"==t.approval.status&&t.approval.hooks.length>0?i("v-card-text",[i("v-container",{attrs:{fluid:""}},[i("v-divider"),t._l(t.approval.hooks,(function(e){return i("div",{key:e.id,staticClass:"approved my-2"},[i("HookDetail",{attrs:{hook:e,editable:t.editable},on:{"on-delete":function(){return t.on_hook_deleted(e)}}})],1)}))],2)],1):"approved"!=t.approval.status?i("v-card-text",[i("v-row",[i("v-col",[t.approval.permissions.length?i("v-row",[i("v-col",{attrs:{cols:"4"}},[i("label",[t._v("have permissions:")])]),i("v-col",t._l(t.approval.permissions,(function(e,a){return i("span",{key:e.id},[i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-lock")]),i("span",{domProps:{textContent:t._s(e.identifier)}})],1),a!=t.approval.permissions.length-1?i("span",[t._v("or")]):t._e()],1)})),0)],1):t._e(),t.approval.groups.length?i("v-row",[i("v-col",{attrs:{cols:"4"}},[i("label",[t._v("are in groups:")])]),i("v-col",t._l(t.approval.groups,(function(e,a){return i("span",{key:e.id},[i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-account-multiple")]),i("span",{domProps:{textContent:t._s(e.name)}})],1),a!=t.approval.groups.length-1?i("span",[t._v("or")]):t._e()],1)})),0)],1):t._e(),i("v-row",[t.approval.hooks.length>0?i("v-container",{attrs:{fluid:""}},[i("v-divider"),i("span",{staticClass:"title font-weight-light"},[t._v("Right after this is approved")]),t._l(t.approval.hooks,(function(e){return i("div",{key:e.id,staticClass:"my-2"},[i("HookDetail",{attrs:{hook:e,editable:!e.is_from_upstream()&&t.editable},on:{"on-delete":function(){return t.on_hook_deleted(e)}}})],1)}))],2):t._e()],1)],1)],1)],1):t._e()],1),i("v-dialog",{attrs:{"max-width":"800"},model:{value:t.newHookDialog,callback:function(e){t.newHookDialog=e},expression:"newHookDialog"}},[i("CreateApprovalHookForm",{attrs:{workflow:t.workflow,transition_approval_meta_id:t.approval.transition_approval_meta,transition_approval_id:t.approval.id,object_id:t.object_id,excluded_function_ids:t.approval.hooks.map((function(t){return t.callback_function.id}))},on:{"on-create":t.on_hook_created}})],1)],1)},Yi=[],Ki={name:"ObjectApprovalDetail",components:{HookDetail:We,CreateApprovalHookForm:Ge},props:["workflow","approval","object_id","editable"],data:()=>({fab:!1,newHookDialog:!1}),methods:{on_hook_created(t){this.$emit("on-hook-create",t),this.newHookDialog=!1},on_hook_deleted(t){this.$emit("on-hook-delete",t)}}},Xi=Ki,Zi=(i("5e69"),Object(d["a"])(Xi,Qi,Yi,!1,null,null,null)),ta=Zi.exports,ea={name:"ObjectApprovalList",components:{ObjectApprovalDetail:ta,HookDetail:We},props:["workflow","object_id","object_approvals","editable"],data:()=>({drag:!1,items:[]}),computed:{},watch:{object_approvals(t){t!=this.items&&this.update_items()}},mounted(){this.update_items()},methods:{update_items(){this.items=this.object_approvals.map((t,e)=>({...t,priority:e+1}))},on_hook_created(t){this.$emit("on-hook-create",t)},on_hook_deleted(t){this.$emit("on-hook-delete",t)}}},ia=ea,aa=(i("ad44"),Object(d["a"])(ia,Vi,Bi,!1,null,null,null)),oa=aa.exports,na={name:"EditWorkflowObjectTimelinePage",components:{EmptyState:mt,CreateTransitionHookForm:Ee,WorkflowIllustration:ue,ObjectApprovalList:oa,HookDetail:We},props:["readonly"],data:()=>({initialized:!1,fab:null,workflow:null,object_identifier:null,selected_transition:null,transition_approvals:{},transitions:null,states:null,current_state:null,alert_timeout:2e3,current_iteration:null,newTransitionHookDialog:!1,state_class_mapping:{},deletingTransitionHook:null,deletingTransitionHookDialog:!1,deletingApprovalHook:null,deletingApprovalHookDialog:!1,pending_state_class:{rect:{"stroke-dasharray":"10 5",fill:"white"}},done_state_class:{rect:{fill:"#4caf50"},label:{stroke:"white"}},cancelled_state_class:{rect:{fill:"rgb(195, 189, 189)"},label:{stroke:"white"}},current_state_class:{rect:{fill:"deepskyblue"},label:{stroke:"white"}}}),mounted(){var t=this.$route.params.workflow_id,e=this.$route.params.object_id;P.get(`/workflow/get/${t}/`,i=>{this.workflow=Ct.of(i.data.id,i.data.content_type,i.data.initial_state,i.data.field_name);P.get(`/workflow-object/identify/${this.workflow.id}/${e}/`,t=>{this.object_identifier=t.data});var a=P.get(`/workflow-object/current-state/${this.workflow.id}/${e}/`,t=>{this.current_state=$t.of(t.data.id,t.data.label)}),o=P.get(`/workflow-object/current-iteration/${this.workflow.id}/${e}/`,t=>{this.current_iteration=t.data}),n=this.get_states(t,e).then(t=>this.states=t),s=this.get_transitions(t,e).then(t=>this.transitions=t).then(()=>{var t=this;this.transitions.forEach(e=>{e.is_done?(t.state_class_mapping[e.source_state_id]=t.done_state_class,t.state_class_mapping[e.destination_state_id]=t.done_state_class):e.is_cancelled?t.state_class_mapping[e.destination_state_id]=t.cancelled_state_class:t.state_class_mapping[e.destination_state_id]=t.pending_state_class})});Promise.all([n,s,a,o]).then(()=>{this.state_class_mapping[this.to_state_id(this.current_iteration-1,this.current_state.id)]=this.current_state_class;var t=this.$route.query.selected_transition_id;t&&this.on_transition_selected(t),this.initialized=!0})})},methods:{to_state_id(t,e){return`${t}-${e}`},get_states(t,e){return P.get(`/workflow-object/state/list/${t}/${e}/`,t=>{return t.data.map(t=>$t.of(this.to_state_id(t.iteration,t.state.id),t.state.label))})},get_transitions(t,e){var i=this;return P.get(`/workflow-object/transition/list/${t}/${e}/`,t=>{return Promise.all(t.data.map(t=>{t=Ht.of(t.id,this.workflow,this.to_state_id(t.iteration-1,t.source_state),this.to_state_id(t.iteration,t.destination_state),t.meta,t.object_id,t.iteration,t.is_cancelled,t.is_done);var e=i.get_transition_approvals(t.id).then(e=>{t.approvals=e}),a=i.get_transition_hooks(t).then(e=>{t.hooks=e});return Promise.all([e,a]).then(()=>t)}))})},get_transition_hooks(t){return P.get(`/transition/transition-hook/list/${t.id}/`,e=>{return e.data.map(e=>Et.of(e.id,this.workflow,e.callback_function,e.transition_meta,e.transition,e.object_id,t.is_done))})},get_transition_approvals(t){var e=this;return P.get(`/transition/transition-approval/list/${t}/`,t=>{return Promise.all(t.data.map(t=>{var i=At.of(t.id,this.workflow,t.transition,t.meta,t.object_id,t.permissions,t.groups,t.priority,t.status,t.transactioner);return e.get_transition_approval_hooks(i).then(t=>{i.hooks=t}).then(()=>i)}))})},get_transition_approval_hooks(t){return P.get(`/transition-approval/approval-hook/list/${t.id}/`,e=>{return e.data.map(e=>Tt.of(e.id,this.workflow,e.callback_function,e.transition_approval_meta,e.transition_approval,e.object_id,t.is_approved))})},on_transition_hook_created(t){this.selected_transition&&!this.selected_transition.hooks.find(e=>e.id==t.id)&&(P.post("/transition-hook/create/",t.to_create_request(),e=>{t.id=e.data.id,this.selected_transition.hooks.push(t),this._update_transition(this.selected_transition)}),this.newTransitionHookDialog=!1,k("The transition hook is created",this.alert_timeout))},on_transition_hook_deleted(t){this.deletingTransitionHook=t,this.deletingTransitionHookDialog=!0},delete_transition_hook(){this.selected_transition&&P.delete(`/transition-hook/delete/${this.deletingTransitionHook.id}/`,t=>{this.selected_transition.hooks=this.selected_transition.hooks.filter(t=>t.id!=this.deletingTransitionHook.id),this._update_transition(this.selected_transition),this.deletingTransitionHook=null,this.deletingTransitionHookDialog=!0,k("The transition hook is deleted",this.alert_timeout)})},on_approval_hook_created(t){if(this.selected_transition){var e=this.selected_transition.approvals.find(e=>e.id==t.transition_approval_id);e&&!e.hooks.find(e=>e.id==t.id)&&P.post("/approval-hook/create/",t.to_create_request(),i=>{t.id=i.data.id,e.hooks.push(t),this._update_approval(this.selected_transition,e),this._update_transition(this.selected_transition),k("The approval hook is created",this.alert_timeout)})}},on_approval_hook_deleted(t){this.deletingApprovalHook=t,this.deletingApprovalHookDialog=!0},delete_approval_hook(){if(this.selected_transition){var t=this.selected_transition.approvals.find(t=>t.id==this.deletingApprovalHook.transition_approval_id);t&&P.delete(`/approval-hook/delete/${this.deletingApprovalHook.id}`,e=>{t.hooks=t.hooks.filter(t=>t.id!=this.deletingApprovalHook.id),this._update_approval(this.selected_transition,t),this._update_transition(this.selected_transition),this.deletingApprovalHook=null,this.deletingApprovalHookDialog=!0,k("The approval hook is deleted",this.alert_timeout)})}},on_transition_selected(t){this.selected_transition=this.transitions.find(e=>e.id==t),this._update_query({selected_transition_id:JSON.stringify(t)})},get_state_by(t){return this.states.find(e=>e.id==t)},_update_transition(t){this.transitions=this.transitions.map(e=>e.id==t.id?t:e)},_update_approval(t,e){t.approvals=t.approvals.map(t=>t.id==e.id?e:t)},_update_query(t){var e={...this.$route.query,...t},i=this;Object.keys(e).some(t=>i.$route.query[t]!=e[t])&&this.$router.push({query:e})}}},sa=na,ra=Object(d["a"])(sa,Gi,Ji,!1,null,null,null),la=ra.exports,ca=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",{attrs:{justify:"center",align:"center"}},[i("h1",[i("v-icon",{staticClass:"mb-2",staticStyle:{"font-size":"35px"}},[t._v("mdi-label-variant-outline")]),t._v(" States\n      ")],1)])],1),i("v-row",{attrs:{justify:"center",align:"center"}},[i("v-col",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.items,"items-per-page":10},scopedSlots:t._u([{key:"item.action",fn:function(e){var a=e.item;return[i("v-icon",{staticClass:"mr-1",attrs:{color:"warning",disabled:!t.has_delete_state_permission},on:{click:function(e){return t.showDeletingDialog(a)}}},[t._v("mdi-delete")])]}}])})],1)],1),this.deletingState?i("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("\n        Delete state\n        "),i("v-chip",{staticClass:"white--text",attrs:{color:"primary"}},[i("v-icon",{attrs:{left:""}},[t._v("mdi-label-variant")]),t._v("\n          "+t._s(t.deletingState.label)+"\n        ")],1),t._v("?\n      ")],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{large:"",color:"primary"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Close")]),i("v-btn",{attrs:{large:"",color:"warning"},on:{click:function(e){return t.deleteState()}}},[t._v("Agree")])],1)],1)],1):t._e()],1)},da=[],ua={name:"ListStatePage",data:()=>({deletingState:null,deleteDialog:!1,headers:[{text:"Slug",value:"slug",align:"left"},{text:"Label",value:"label",align:"left"},{text:"Actions",value:"action",sortable:!1}],items:[],has_delete_state_permission:!1}),mounted(){this.fetchStates()},methods:{fetchStates(){var t=P.get("/state/list/",t=>{this.items=t.data}),e=M.has_delete_permission(N,t=>{this.has_delete_state_permission=t});Promise.all([t,e]).then(()=>this.initialized=!0)},showDeletingDialog(t){this.deletingState=t,this.deleteDialog=!0},deleteState(){this.deletingState&&P.delete(`/state/delete/${this.deletingState.id}/`,()=>{this.fetchStates(),this.deleteDialog=!1,k(`State '${this.deletingState.label}' is deleted`)})}}},_a=ua,pa=(i("e709"),Object(d["a"])(_a,ca,da,!1,null,null,null)),ha=pa.exports;S.commit("initialiseStore"),a["default"].use(at["a"]);var va=new at["a"]({routes:[{path:"/login",name:"login",component:ct,meta:{layout:"NotLoggedInLayout",allowGuest:!0}},{path:"/",name:"home",component:zt},{path:"/workflows",name:"list-workflows",component:zt},{path:"/workflow/view/:id",name:"view-workflow",component:oi,props:{readonly:!0}},{path:"/workflows/create",name:"create-workflow",component:te},{path:"/workflow/edit/:id",name:"edit-workflow",component:ve,props:{readonly:!1}},{path:"/workflow/edit/rules/:id",name:"edit-workflow-rules",component:oi,props:{readonly:!1}},{path:"/callback-functions",name:"list-callback-functions",component:di},{path:"/callback-functions/create",name:"create-callback-function",component:$i},{path:"/callback-functions/view/:id",name:"view-callback-function",component:Ai},{path:"/callback-functions/edit/:id",name:"edit-callback-function",component:Li},{path:"/workflow-object/:workflow_id",name:"list-workflow-objects",component:Ui},{path:"/workflow-object/timeline/:workflow_id/:object_id",name:"edit-workflow-object-timeline",component:la},{path:"/states",name:"list-states",component:ha}]});va.beforeEach((t,e,i)=>{var a=S.state.user.token;t.matched.some(t=>t.meta.allowGuest)?null!=a&&"login"==t.name?i({name:"home"}):i():null!=a?M.has_view_permission(F,t=>{t?i():(w(["You has to have the permission to view the workflows!"],1e4),b())}):i({name:"login",params:{nextUrl:t.fullPath}})});var fa=va;a["default"].config.productionTip=!1,new a["default"]({store:S,router:fa,vuetify:it,render:t=>t(X)}).$mount("#app")},"2af9":function(t,e,i){"use strict";var a=i("66f5"),o=i.n(a);o.a},4544:function(t,e,i){},"5a6f":function(t,e,i){"use strict";var a=i("c7be"),o=i.n(a);o.a},"5e44":function(t,e,i){},"5e69":function(t,e,i){"use strict";var a=i("f8f4"),o=i.n(a);o.a},"66f5":function(t,e,i){},"6d29":function(t,e,i){"use strict";var a=i("beeb"),o=i.n(a);o.a},7262:function(t,e,i){},"7b33":function(t,e,i){},"86de":function(t,e,i){"use strict";var a=i("5e44"),o=i.n(a);o.a},"98dc":function(t,e,i){},a47f:function(t,e,i){},ad44:function(t,e,i){"use strict";var a=i("98dc"),o=i.n(a);o.a},b9fa:function(t,e,i){},beeb:function(t,e,i){},c391:function(t,e,i){"use strict";var a=i("a47f"),o=i.n(a);o.a},c7be:function(t,e,i){},d21c:function(t,e,i){"use strict";var a=i("b9fa"),o=i.n(a);o.a},daf8:function(t,e,i){"use strict";var a=i("7262"),o=i.n(a);o.a},e4a5:function(t,e,i){"use strict";var a=i("7b33"),o=i.n(a);o.a},e709:function(t,e,i){"use strict";var a=i("4544"),o=i.n(a);o.a},f3e5:function(t,e,i){t.exports=i.p+"../static/img/logo.70a5d670.svg"},f8f4:function(t,e,i){}});
//# sourceMappingURL=app.2e387f1a.js.map